---
sidebar_position: 2
---

# 变量和数据类型

## 变量和可变性

Rust的变量不同于其他编程语言的变量，其本质上是一种绑定语义，即将一个变量名与一个值绑定在一起。变量名和值建立关联关系。

### 变量声明

使用let关键字声明，先声明后使用。

```bash
let x: i8 = 1;
let x = 1; 		//等价于：let x:i32 =1;
```

变量声明以let关键字开头，x为变量名，变量名后紧跟冒号和数据类型。Rust编译器具有变量类型的自动推导功能。在可以根据赋值类型或上下文信息推导出变量类型的情况下，冒号和数据类型可以省略。

变量名必须由字母、数字、下划线组成，字母区分大小写且不能以数字开头，也不能只有下划线。Rust中下划线是一种特殊的标识符，其含义是“忽略这个变量”，后续章节中会用到这个标识符。

### 变量的可变性

`let`声明的变量默认是不可变的，在第一次赋值后不能通过再次赋值来改变它的值，即声明的变量是只读状态。

```rust
1  fn main() {
2      let x = 3;
3      x = 5; 	// error
4      println!("x: {}", x);
5  }
```

如果尝试对不可变变量x进行二次赋值，即进行写操作，这是不被允许的。编译代码，将会抛出`cannot assign twice to immutable variable x`的错误提示。根据错误提示信息可知，不能对不可变变量进行二次赋值。

### 变量遮蔽

Rust允许在同一个代码块中声明一个与之前已声明变量同名的新变量，新变量会遮蔽之前的变量，即无法再去访问前一个同名的变量，这样就实现了变量遮蔽。

```rust
 1  fn main() {
 2      let x = 3;
 3      let x = x + 2;	// 第一个变量被遮蔽， x = 5
 4      let x = x * 2;	// 第二个变量被遮蔽， x = 10
 5      println!("x: {}", x);
 6
 7      let x = "Hello, Rust!";	 	//变量x已由i32类型变为&str类型
 8      println!("x: {}", x);
 9  }
10
11 // x: 10
12 // x: Hello, Rust!
```

变量遮蔽的实质是通过let关键字声明了一个新的变量，只是名称恰巧与前一个变量名相同而已，但它们是两个完全不同的变量，处于不同的内存空间，值可以不同，值的类型也可以不同。

### 常量

常量是指绑定到一个标识符且不允许改变的值，一旦定义后就没有任何方法能改变其值了。Rust声明常量的语法如下：

```rust
const MAX_NUM: u32 = 1024;
```

Rust使用`const`关键字来声明常量。常量名通常是大写字母，且必须指定常量的数据类型。

> 常量与不可变变量的区别主要在于：
>
> 1. 常量声明使用const关键字，且必须注明值的类型。
> 2. 通过变量遮蔽的方式可以让不可变变量的值改变（本质上是新的变量，只是同名而已）。但是，常量不能遮蔽，不能重复定义。
> 3. 常量可以在任何作用域中声明，包括全局作用域。在声明它的作用域中，常量在整个程序生命周期内都有效，这使得常量可以作为多处代码共同使用的全局范围的值。
> 4. 常量只能被赋值为常量表达式或数学表达式，不能是函数返回值，或是其他在运行时才能确定的值。

## 基本数据类型

### 整数类型

整数是指没有小数部分的数字，整数可以分为有符号整数和无符号整数。按照存储字节大小，整数类型可以进一步分为1字节、

2字节、4字节、8字节、16字节（1字节=8位）。Rust默认的整数类型是i32，isize和usize主要作为数组或集合的索引类型使用，其长度依赖于运行程序的计算机系统。在64位计算机系统上，其长度是64位；在32位计算机系统上，其长度是32位。

| 长度  | 有符号 | 无符号 |
| ------- | -------- | :------: |
| 8位   | i8     |   u8   |
| 16位  | i16    |  u16  |
| 32位  | i32    |  u32  |
| 64位  | i64    |  u64  |
| 128位 | i128   |  u128  |
| arch  | isize  | usize |

整数类型声明，前缀`0b`、`0o`和`0x`表示二进制、八进制和十六进制的数字。

```rust
let integer1:u32 = 17;  // 类型声明
let integer2 = 17u32;  // 类型后缀声明
let integer3 = 17;  // 类型推断，默认i32
let integer4:u32 = 0b10101;  // 二进制
let integer5:u32 = 0o21;  // 八进制
let integer6:u32 = 0x11;  // 十六进制
let integer7:u32 = 1_000_000;  // 下划线分隔数字
let integer8:u32 = 1_000_000u32;  // 下划线分隔数字，类型后缀
```

### 浮点数类型

浮点数是指带小数点的数字，比如0.0、1.0、-2.1、9.99999等。按照存储大小，浮点数分为`f32`和`f64`两类。Rust默认的浮点数类型是`f64`。

`f32`：单精度浮点数，小数点后至少有6位有效数字。

`f64`：双精度浮点数，小数点后至少有15位有效数字。

```rust
// 浮点数类型
// 浮点数类型有两种，分别是：f32, f64
// 32位浮点数：f32
// 64位浮点数：f64
let float1:f32 = 3.14;  // 类型声明
let float2 = 3.14f32;  // 类型后缀声明
let float3 = 3.14;  // 类型推断，默认f64
let float4:f32 = 3.14e2;  // 科学计数法
ler float5  = 11_000.555_0001;  // 下划线分隔数字
```

### 布尔类型

Rust使用bool来声明布尔类型的变量，声明的语法如下所示。布尔类型只有两个可能的取值，即true或false，一般用于逻辑表达式中。

```rust
1  let t: bool = true;           // 显式类型声明
2  let f = false;                // 隐式类型声明
```

### 字符类型

Rust使用UTF-8作为底层的编码。字符类型代表的是一个Unicode标量值（Unicode Scalar Value），包括数字、字母、Unicode和其他特殊字符。每个字符占4个字节。字符类型char由单引号来定义，其声明语法如下所示。

```rust
let a = 'a';      // 正确
let b = "a";      // 错误，这是字符串切片 &str
```

转义字符

```rust
let newline = '\n';  // 换行
let tab = '\t';      // 制表符
let quote = '\'';    // 单引号
```

Unicode 码点

```rust
let hex_char = '\x2A';       // ASCII 字符 '*'（等价于 '2A'）
let unicode_char = '\u{CA0}'; // Unicode 字符 "ಠ"（卡纳达语字符）
```

> 1. 转换为整数
>
> 使用 as 运算符将 char 转换为整数类型，但高位可能被截断27：
>
> ```rust
> assert_eq!('A' as u8, 65);     // ASCII 转换
> assert_eq!('ಠ' as u16, 0xCA0); // Unicode 转换（截断为 16 位）
> ```
>
> 2. 整数转字符
>
> 仅 `u8 `可直接通过 `as `转换为 char，其他整数需使用` std::char::from_u32()` 并检查有效性27：
>
> ```rust
> let valid_char = std::char::from_u32(0xCA0).unwrap(); // Some('ಠ')
> let invalid_char = std::char::from_u32(0xDEAD);       // None
> ```

### 范围类型

范围类型常用来生成从一个整数开始到另一个整数结束的整数序列，有左闭右开和全闭两种形式，比如`（1..5）`是左闭右开区间，表示生成`1、2、3、4`这4个数字；`（1..=5）`是全闭区间，表示生成`1、2、3、4、5`这5个数字。

```rust
// 范围类型
print!("(1..5):");
for i in 1..5 {
    print!(" {}", i);
}
println!();

print!("(1..=5).rev:");
for i in (1..=5).rev() {
    print!(" {}", i);
}
println!();

let sum: i32 = (1..=5).sum();  // 范围求和
println!("sum: {}", sum);
```

## 复合数据类型

复合数据类型是由其他类型组合而成的类型。Rust的复合数据类型有元组、数组、结构体、枚举等。